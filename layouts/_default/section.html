{{- define "main" -}}
  {{- $section := .Section -}}
  {{- $sort_config := .Site.Params.sort_order.archive | default "date-reverse" -}}
  {{- $pages := where .Site.RegularPages "Section" $section -}}
  
  {{/* 排序逻辑 */}}
  {{- if eq $sort_config "weight" -}}
    {{- $pages = $pages.ByWeight -}}
  {{- else if eq $sort_config "weight-reverse" -}}
    {{- $pages = $pages.ByWeight.Reverse -}}
  {{- else if eq $sort_config "date" -}}
    {{- $pages = $pages.ByDate -}}
  {{- else -}}
    {{- $pages = $pages.ByDate.Reverse -}}
  {{- end -}}

  {{- $paginator := .Paginate $pages -}}

  {{/* 标题区域 */}}
  <div class="archive-header">
    <h2 class="archive-title">{{ .Title }}</h2>
    <span class="archive-count">共 {{ len $pages }} 个</span>
  </div>

  {{/* 网格容器 */}}
  <div class="reimu-grid-container">
    {{- range $paginator.Pages -}}
      <article class="reimu-grid-item" data-aos="zoom-in">
        <a href="{{ .Permalink }}" class="reimu-grid-link">
          
          {{/* 封面图 */}}
          <div class="reimu-grid-cover">
            {{- $cover := .Params.cover -}}
            {{- if not $cover -}}
               {{- $cover = partial "helpers/randomCover.html" . -}}
            {{- end -}}
            {{- if not $cover -}}
               {{- $cover = .Site.Params.banner -}}
            {{- end -}}
            
            <img data-src="{{ $cover | relURL }}" class="lazyload" alt="{{ .Title }}">
          </div>

          {{/* 内容区域 */}}
          <div class="reimu-grid-info">
            <h3 class="reimu-grid-title">{{ .Title }}</h3>
            <p class="reimu-grid-desc">
              {{- if .Params.description -}}
                {{ .Params.description }}
              {{- else if .Summary -}}
                {{ .Summary | plainify | truncate 50 }}
              {{- else -}}
                暂无描述
              {{- end -}}
            </p>
          </div>
        </a>
      </article>
    {{- end -}}
  </div>

  {{- partial "pagination.html" . -}}
{{- end -}}